<!DOCTYPE html>
<html>
<head>
    <title>The Legend of Suffixia: Advanced Quest</title>
    <meta charset="utf-8">
    <style>
        body { margin: 0; overflow: hidden; background-color: #1a1a1a; font-family: 'Verdana', sans-serif; }
        
        /* The Question Box Overlay */
        #ui-layer {
            position: absolute;
            top: 50%; left: 50%;
            transform: translate(-50%, -50%);
            background: #f4f4f4;
            padding: 25px;
            border: 4px solid #4a90e2;
            border-radius: 12px;
            text-align: center;
            display: none; /* Hidden by default */
            box-shadow: 0 15px 30px rgba(0,0,0,0.7);
            width: 400px;
            z-index: 100;
        }
        h2 { margin-top: 0; color: #333; font-size: 20px; }
        p.scenario { font-style: italic; color: #555; margin-bottom: 20px; font-size: 16px; }
        input { padding: 12px; font-size: 18px; width: 80%; border: 2px solid #ddd; border-radius: 4px; }
        button { padding: 12px 24px; font-size: 18px; margin-top: 15px; background: #4a90e2; color: white; border: none; border-radius: 4px; cursor: pointer; transition: background 0.2s; }
        button:hover { background: #357abd; }
        .instructions { position: absolute; bottom: 20px; left: 20px; color: white; opacity: 0.8; font-size: 14px; background: rgba(0,0,0,0.5); padding: 10px; border-radius: 5px;}
    </style>
</head>
<body>

    <div id="ui-layer">
        <h2 id="question-header">Monster Encounter!</h2>
        <p class="scenario" id="question-text">...</p>
        <input type="text" id="answer-input" placeholder="Type the -ish word..." autocomplete="off">
        <br>
        <button onclick="checkAnswer()">Cast Spell</button>
        <p id="feedback" style="font-weight: bold; color: #d9534f; min-height: 24px;"></p>
    </div>

    <div class="instructions">
        <strong>CONTROLS:</strong> Arrow Keys to Move â€¢ Touch Enemies to Battle<br>
        <strong>GOAL:</strong> Solve the riddles using the suffix <em>-ish</em>.
    </div>

    <script src="https://unpkg.com/kaboom@3000.0.1/dist/kaboom.js"></script>

    <script>
    // 1. Initialize Game
    kaboom({
        background: [40, 40, 50], // Darker dungeon floor
        scale: 2,
    });

    // 2. Load "Sprites" (Using Emojis)
    loadSprite("hero", "https://ui-avatars.com/api/?name=Link&background=0D8ABC&color=fff&size=64&font-size=0.5");

    // 3. Define the Educational Content (The "Curriculum")
    const LEVEL_CONFIG = {
        tileWidth: 48,
        tileHeight: 48,
        tiles: {
            // TERRAIN
            "=": () => [ text("ðŸŒ²"), area(), body({ isStatic: true }), anchor("center"), "wall" ],
            "#": () => [ rect(48, 48), color(80, 80, 80), area(), body({ isStatic: true }), "wall" ], 
            "~": () => [ text("ðŸŒŠ"), area(), body({ isStatic: true }), anchor("center"), "water" ],
            "@": () => [ text("ðŸ§"), area(), body(), anchor("center"), "player" ],

            // ENEMIES (The Questions)
            
            // Level 1: Basic Recall (Color/Appearance)
            "1": () => [ text("ðŸ‘»"), area(), body({ isStatic: true }), anchor("center"), "enemy", { 
                word: "greenish", 
                header: "The sickly ghost...",
                clue: "This ghost isn't bright green, but it has a sick, pale tint. It is..." 
            }],

            // Level 2: Math/Time Approximation (Application)
            "2": () => [ text("â°"), area(), body({ isStatic: true }), anchor("center"), "enemy", { 
                word: "noonish", 
                header: "The Timekeeper blocks you!",
                clue: "The meeting was supposed to be at 12:00 PM, but they said to arrive broadly around that time. When should you arrive?" 
            }],

            // Level 3: Metaphor/Idiom (Analysis)
            "3": () => [ text("ðŸ‘"), area(), body({ isStatic: true }), anchor("center"), "enemy", { 
                word: "sheepish", 
                header: "A shy creature appears...",
                clue: "The boy dropped his tray in the cafeteria. He looked up, feeling embarrassed and shy. He gave a ______ grin." 
            }],

            // Level 4: Personality/Nuance (Evaluation)
            "4": () => [ text("ðŸ‘º"), area(), body({ isStatic: true }), anchor("center"), "enemy", { 
                word: "selfish", 
                header: " The Greedy Goblin!",
                clue: "This goblin refuses to share anything. He only cares about his own needs. His behavior is..." 
            }],

            // Level 5: Quantity/Estimate (Math Connection)
            "5": () => [ text("ðŸº"), area(), body({ isStatic: true }), anchor("center"), "enemy", { 
                word: "fullish", 
                header: "The Potion Master",
                clue: "Is the glass full? Not mostly, but somewhat. It's not empty, it's..." 
            }],

            // BOSS: Complex Synthesis
            "$": () => [ text("ðŸ‰"), area(), body({ isStatic: true }), anchor("center"), "boss", { 
                word: "squeamish", 
                header: "THE DRAGON OF DISGUST",
                clue: "FINAL TEST: I faint when I see blood. I am easily sickened by gross things. I am..." 
            }]
        }
    };

    // 4. Map Design (Visual Layout)
    const level = addLevel([
        "###################",
        "#      #          #",
        "#  @   #    2     #", // Start & Time Question
        "#      #          #",
        "#######=     =####",
        "#          ~      #",
        "#    1     ~   3  #", // Color & Sheep Question
        "#          ~      #",
        "####=  =##########",
        "#          #      #",
        "#    4     #   5  #", // Selfish & Fullish
        "#          #      #",
        "#######  #########",
        "#                 #",
        "#        $        #", // BOSS
        "#                 #",
        "###################",
    ], LEVEL_CONFIG);

    // 5. Player Setup
    const player = add([
        text("ðŸ§"), 
        pos(center()),
        area(), 
        body(), 
        anchor("center"),
        "hero"
    ]);

    // 6. Movement
    const SPEED = 220;
    onKeyDown("left", () => player.move(-SPEED, 0));
    onKeyDown("right", () => player.move(SPEED, 0));
    onKeyDown("up", () => player.move(0, -SPEED));
    onKeyDown("down", () => player.move(0, SPEED));

    player.onUpdate(() => {
        camPos(player.pos);
    });

    // --- BATTLE LOGIC ---

    let currentEnemy = null;

    // Handle collision with enemies
    player.onCollide("enemy", (enemy) => startBattle(enemy));
    player.onCollide("boss", (boss) => startBattle(boss));

    function startBattle(enemy) {
        currentEnemy = enemy;
        debug.paused = true; // Pause movement
        
        // Populate UI
        document.getElementById("ui-layer").style.display = "block";
        document.getElementById("question-header").innerText = enemy.header;
        document.getElementById("question-text").innerText = enemy.clue;
        document.getElementById("feedback").innerText = "";
        
        const input = document.getElementById("answer-input");
        input.value = "";
        input.focus();
    }

    // Check Answer Logic
    window.checkAnswer = function() {
        const input = document.getElementById("answer-input");
        const ui = document.getElementById("ui-layer");
        const feedback = document.getElementById("feedback");

        if (input.value.toLowerCase().trim() === currentEnemy.word) {
            // Correct
            currentEnemy.destroy(); 
            ui.style.display = "none"; 
            debug.paused = false; 
            shake(5); 
        } else {
            // Incorrect
            feedback.innerText = "The spell fizzled! Try again.";
            shake(2);
            input.value = "";
            input.focus();
        }
    }
    
    // Allow pressing "Enter" to submit
    document.getElementById("answer-input").addEventListener("keypress", function(event) {
        if (event.key === "Enter") {
            window.checkAnswer();
        }
    });

    </script>
</body>
</html>
